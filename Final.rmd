---
title: "Covid91 vaccine study Final2022"
author: "Kaylie Brehm"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="final_Data.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
#FinalData$infected <- relevel(FinalData$infected,ref="OK")
Male = filter(FinalData, sex =="M")
Female = filter(FinalData, sex =="F")
Gay = filter(FinalData, LGBTQ =="gay")
DrugUser = filter(FinalData, DrugUser =="yes")
```

# Introduction

A new  preventative vaccine (covid91) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.



# Hypothesis and Method

$H_0$: The preventative vaccine, covid91, is not effective for this particular subgroup (male, female, gay, or drug user).

$H_A$: The preventative vaccine, covid91, is effective for this particular subgroup (male, female, gay, or drug user).

Whether an individual was infected or not is categorical. Whether an individual was male or female is categorical. Whether an individual is gay or straight is categorical. Whether an individual is a drug user or not is categorical. I will use a CAT~CAT analysis to determine whether the vaccine was effective for each particular subgroup. In each subgroup section, I will use a bar chart (graphical descriptive results), a data table (numerical descriptive results), a chi-squared test (inferential descriptive results), and a fisher exact test (inferential descriptive results). I will also define the upper and lower confidence intervals, and run a test for effectiveness. Then, in each subgroup section, I will analyze the data and give a conclusion. Once each subgroup is completed, I will give my overall thoughts thoughts on the study. 

## Male

### Graphical Descriptive Results

```{r}
dd2 <- Male %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))
basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")
#Now for percentage plot
basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

The plots represent the population of males and their relationship to getting covid-19 by taking either the vaccine or placebo. There are two plots that came out. Both plots show two bars for treatment, the placebo or the vaccine. Along the x-axis is the count of people who came in contact with covid. Along the y-axis is those infected with covid. The first plot shows the number of people infected with covid. The second plot shows the percentage of people infected with covid.

The bar plot depicts that roughly 26% of the male population who got covid-19, took the vaccine. Whereas, about 68% of the males who got covid-19, took the placebo. For men who did not get covid-19, we can see that the difference is about half for either taking the placebo or vaccine. A substantially higher percentage of men who took the placebo, contracted covid-19, compared to men who took the vaccine. This indicates that the vaccine appears effective for the male population.



### Numerical Descriptive Results 

```{r}
table1 <- xtabs(~infected + treatment, data=Male)
rowPerc(table1)
colPerc(table1)
```

The data table above show values of the male population. It shows both count and percentages. The table shows all the case scenarios, those infected with covid after vaccine, those not infected with covid after placebo, etc. 

About 68% of males that took the placebo, got covid-19. While about 32% that took the vaccine got covid-19. The vaccine is clearly effective here in preventing covid-19 among males. Those who took the vaccine were much less likely to get covid-19. The odds of getting covid-19 for this group, while taking the placebo, is 2.6 to 1.3, or 2:1.



### Inferential Descriptive Results 

```{r}
table1 <- xtabs(~infected + treatment, data=Male)
chisq.test(table1)
chisqtestGC(table1)
malesfish <- fisher.test(table1)
malesfish
```

### Effictiveness and Confidence Intervals

```{r}
effect <- malesfish$p.value/(malesfish$p.value +1)
effectivenessguy = malesfish$estimate/(malesfish$estimate +1)*100
print(effectivenessguy)
```


```{r}
low=(malesfish$conf.int[1]/(malesfish$conf.int[1] +1))*100
hi=(malesfish$conf.int[2]/(malesfish$conf.int[2] +1))*100
options(digits=2)
```

### Conclusion



## Female

### Graphical Descriptive Results

```{r}
dd2 <- Female %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))
basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")
#Now for percentage plot
basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

The plots represent the population of females and their relationship to getting covid-19 by taking either the vaccine or placebo. There are two plots that came out. Both plots show two bars for treatment, the placebo or the vaccine. Along the x-axis is the count of people who came in contact with covid. Along the y-axis is those infected with covid. The first plot shows the number of people infected with covid. The second plot shows the percentage of people infected with covid.

The bar plot depicts that roughly 41% of the female population who got covid-19, took the vaccine. Whereas, about 59% of the females who got covid-19, took the placebo. For women who did not get covid-19, we can see that the difference is about half for either taking the placebo or vaccine. A substantially higher percentage of women who took the placebo, contracted covid-19, compared to women who took the vaccine. This indicates that the vaccine appears effective for the female population.

### Numerical Descriptive Results 

```{r}
table2 <- xtabs(~infected + treatment, data=Female)
rowPerc(table2)
colPerc(table2)
```

The data table above show values of the female population. It shows both count and percentages. The table shows all the case scenarios, those infected with covid after vaccine, those not infected with covid after placebo, etc. 

About 59% of females that took the placebo, got covid-19. While about 41% that took the vaccine got covid-19. The vaccine is clearly effective here in preventing covid-19 among females. Those who took the vaccine were much less likely to get covid-19. The odds of getting covid-19 for this group, while taking the placebo, is 2.6 to 1.3, or 2:1.

### Inferential Descriptive Results 

```{r}
table2 <- xtabs(~infected + treatment, data=Female)
chisq.test(table2)
chisqtestGC(table2)
femalesfish <- fisher.test(table2)
femalesfish
```

### Effictiveness and Confidence Intervals

```{r}
effect <- femalesfish$p.value/(femalesfish$p.value +1)
effectivenessfemales = femalesfish$estimate/(femalesfish$estimate +1)*100
print(effectivenessfemales)
```

```{r}
low=(femalesfish$conf.int[1]/(femalesfish$conf.int[1] +1))*100
hi=(femalesfish$conf.int[2]/(femalesfish$conf.int[2] +1))*100
options(digits=2)
```

### Conclusion



## Gay

### Graphical Descriptive Results

```{r}
dd2 <- Gay %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))
basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")
#Now for percentage plot
basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

The plots represent the population of gays and their relationship to getting covid-19 by taking either the vaccine or placebo. There are two plots that came out. Both plots show two bars for treatment, the placebo or the vaccine. Along the x-axis is the count of people who came in contact with covid. Along the y-axis is those infected with covid. The first plot shows the number of people infected with covid. The second plot shows the percentage of people infected with covid.

The bar plot depicts that roughly 79% of the gay population who got covid-19, took the vaccine. Whereas, about 21% of the gays who got covid-19, took the placebo. For gays who did not get covid-19, we can see that the difference is about half for either taking the placebo or vaccine. A substantially higher percentage of gays who took the vaccine, contracted covid-19, compared to gays who took the placebo. This indicates that the vaccine is not effective at all for the gay population.


### Numerical Descriptive Results 

```{r}
table3 <- xtabs(~infected + treatment, data=Gay)
rowPerc(table3)
colPerc(table3)
```


The data table above show values of the gay population. It shows both count and percentages. The table shows all the case scenarios, those infected with covid after vaccine, those not infected with covid after placebo, etc. 

About 13% of gays that took the placebo, got covid-19. While about 87% that took the vaccine got covid-19. The vaccine is clearly not effective here in preventing covid-19 among gays. Those who took the vaccine were much more likely to get covid-19. The odds of getting covid-19 for this group, while taking the placebo, is 0.52 to 3.4, or 0.5:3. 

### Inferential Descriptive Results 

```{r}
table3 <- xtabs(~infected + treatment, data=Gay)
chisq.test(table3)
chisqtestGC(table3)
gayfish <- fisher.test(table3)
gayfish
```



### Effictiveness and Confidence Intervals

```{r}
effect <- gayfish$p.value/(gayfish$p.value +1)
effectivenessgay = gayfish$estimate/(gayfish$estimate +1)*100
print(effectivenessgay)
```

```{r}
low=(gayfish$conf.int[1]/(gayfish$conf.int[1] +1))*100
hi=(gayfish$conf.int[2]/(gayfish$conf.int[2] +1))*100
options(digits=2)
```


### Conclusion



## Drug User

### Graphical Descriptive Results

```{r}
dd2 <- DrugUser %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))
basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")
#Now for percentage plot
basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

The plots represent the population of drug users and their relationship to getting covid-19 by taking either the vaccine or placebo. There are two plots that came out. Both plots show two bars for treatment, the placebo or the vaccine. Along the x-axis is the count of people who came in contact with covid. Along the y-axis is those infected with covid. The first plot shows the number of people infected with covid. The second plot shows the percentage of people infected with covid.

The bar plot depicts that roughly 85% of the drug user population who got covid-19, took the vaccine. Whereas, about 15% of the drug users who got covid-19, took the placebo. For drug users who did not get covid-19, we can see that the difference is about half for either taking the placebo or vaccine. A substantially higher percentage of drug users who took the vaccine, contracted covid-19, compared to drug users who took the placebo. This indicates that the vaccine is not effective at all for the drug user population.

### Numerical Descriptive Results 

```{r}
table4 <- xtabs(~infected + treatment, data=DrugUser)
rowPerc(table4)
colPerc(table4)
```

The data table above show values of the drug user population. It shows both count and percentages. The table shows all the case scenarios, those infected with covid after vaccine, those not infected with covid after placebo, etc. 

About 15% of drug users that took the placebo, got covid-19. While about 85% that took the vaccine got covid-19. The vaccine is clearly not effective here in preventing covid-19 among drug users. Those who took the vaccine were much more likely to get covid-19. The odds of getting covid-19 for this group, while taking the placebo, is 0.6 to 3.28, or 0.6:3.3. 



### Inferential Descriptive Results 

```{r}
table4 <- xtabs(~infected + treatment, data=DrugUser)
chisq.test(table4)
chisqtestGC(table4)
Druguserfish <- fisher.test(table4)
Druguserfish
```

### Effictiveness and Confidence Intervals

```{r}
effect <- Druguserfish$p.value/(Druguserfish$p.value +1)
effectivenessDruguser = Druguserfish$estimate/(Druguserfish$estimate +1)*100
print(effectivenessDruguser)
```

```{r}
low=(Druguserfish$conf.int[1]/(Druguserfish$conf.int[1] +1))*100
hi=(Druguserfish$conf.int[2]/(Druguserfish$conf.int[2] +1))*100
options(digits=2)

```


### Conclusion



# Final Thoughts and Discussion

